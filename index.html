<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>AI Resume Analyzer — Erick Dronski</title>
  <meta name="description" content="Upload your resume PDF and get a personalized 50+ point analysis with recruiter‑grade recommendations. Free and unlimited." />
  <!-- Tailwind for fast styling in this build -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>tailwind.config={theme:{extend:{colors:{brand:{purple:'#8B5CF6',blue:'#3B82F6',ink:'#0b1220'}}}}}</script>
  <!-- PDF.js (use unpkg + no-worker for safe static hosting) -->
  <script src="https://unpkg.com/pdfjs-dist@3.11.174/build/pdf.min.js"></script>
  <style>
    html, body { background: radial-gradient(1200px 600px at 50% -100px, rgba(139,92,246,0.15), transparent 60%) #0b1220; color: #e6e9f5; }
    .glass { backdrop-filter: blur(12px); background: rgba(15,23,42,0.6); border: 1px solid rgba(148,163,184,0.15); }
    .ok  { color:#8B5CF6 }
    .bad { color:#f43f5e }
    .meter { height: 10px; border-radius: 999px; background: rgba(255,255,255,.1); overflow:hidden }
    .meter > i { display:block; height:100%; background: linear-gradient(90deg,#8B5CF6,#60a5fa) }
    .tab-active { background: rgba(139,92,246,.18); color:#e9d5ff; border-color: rgba(196,181,253,.35); }
  </style>
</head>
<body class="min-h-screen">
  <header class="relative overflow-hidden">
    <div class="mx-auto max-w-6xl px-6 pt-12 pb-6">
      <div class="inline-flex items-center gap-2 rounded-full border border-purple-300/20 bg-purple-300/10 px-4 py-1 text-sm text-purple-200">
        <span>⚡ Free & Unlimited</span><span class="opacity-50">•</span><span>Checks 50+ criteria</span><span class="opacity-50">•</span><span>Beat ATS & AI scanners</span>
      </div>
      <h1 class="mt-5 text-4xl md:text-6xl font-extrabold tracking-tight flex items-center gap-2">
        <span class="text-purple-300 text-5xl">🧠</span>
        <span class="bg-gradient-to-r from-purple-200 via-purple-400 to-blue-200 bg-clip-text text-transparent">AI Resume Analyzer</span>
      </h1>
      <p class="mt-4 max-w-3xl text-white/80 text-lg">Upload your resume and get a recruiter‑grade score out of 100 plus targeted fixes to <span class="font-semibold text-purple-200">improve your odds in the job market</span> and <span class="font-semibold text-blue-300">outcompete AI scanners</span>. Completely free. Unlimited runs.</p>

      <!-- Tabs -->
      <div class="mt-6 flex gap-2">
        <button id="tabResume" class="rounded-xl border border-white/10 px-4 py-2 text-sm hover:bg-white/5 tab-active">Resume</button>
        <button id="tabJob" class="rounded-xl border border-white/10 px-4 py-2 text-sm hover:bg-white/5">Job Match</button>
      </div>

      <!-- Upload Card (Resume) -->
      <div id="resumePane" class="glass mt-6 rounded-2xl p-6">
        <div id="dropZone" class="flex flex-col md:flex-row items-center gap-4 border-2 border-dashed border-purple-400/40 rounded-xl p-6 justify-center text-center">
          <label for="fileInput" class="inline-flex items-center rounded-xl bg-purple-500/20 px-4 py-2 text-purple-200 hover:bg-purple-500/30 cursor-pointer">Browse files</label>
          <input id="fileInput" type="file" accept="application/pdf,text/plain" class="sr-only" />
          <span id="fileName" class="ml-3 text-sm text-white/60"></span>
          <button id="analyzeBtn" class="rounded-xl bg-purple-400 text-black px-6 py-3 font-semibold hover:bg-purple-300 disabled:opacity-50" disabled>Analyze Resume</button>
        </div>
        <p class="mt-2 text-sm text-white/60">Supported: PDF (recommended) or plain .txt. Your file never leaves your browser.</p>
      </div>

      <!-- Job Match Pane -->
      <div id="jobPane" class="glass mt-6 rounded-2xl p-6 hidden">
        <div class="grid md:grid-cols-2 gap-4">
          <div>
            <label class="text-sm text-white/70">Paste a job description</label>
            <textarea id="jdText" class="mt-2 w-full h-40 rounded-xl bg-white/5 border border-white/10 p-3 placeholder-white/40" placeholder="Paste the JD here..."></textarea>
            <div class="mt-3 flex items-center gap-3">
              <label for="jdFile" class="inline-flex items-center rounded-xl bg-purple-500/20 px-3 py-2 text-purple-200 hover:bg-purple-500/30 cursor-pointer">Upload JD (.txt)</label>
              <input id="jdFile" type="file" accept="text/plain" class="sr-only" />
              <span id="jdName" class="text-sm text-white/60"></span>
            </div>
          </div>
          <div class="flex items-end gap-3 flex-wrap">
            <button id="analyzeMatchBtn" class="rounded-xl bg-purple-400 text-black px-6 py-3 font-semibold hover:bg-purple-300">Analyze Job Match</button>
            <button id="genBulletBtn" class="rounded-xl bg-blue-400 text-black px-6 py-3 font-semibold hover:bg-blue-300">Generate tailored bullet</button>
          </div>
        </div>
        <p class="mt-2 text-sm text-white/60">We extract role keywords and compare them with your resume to surface gaps, missing skills, and tailoring tips.</p>
      </div>
    </div>
  </header>

  <main class="mx-auto max-w-6xl px-6 pb-24">
    <!-- Resume Results -->
    <section id="results" class="hidden">
      <div class="grid md:grid-cols-3 gap-6 mt-10">
        <div class="glass rounded-2xl p-6 flex items-center justify-center">
          <div class="relative">
            <svg width="140" height="140" viewBox="0 0 140 140">
              <circle cx="70" cy="70" r="54" stroke="#334155" stroke-width="12" fill="none"></circle>
              <circle id="scoreArc" cx="70" cy="70" r="54" stroke="#8B5CF6" stroke-width="12" fill="none" stroke-linecap="round" stroke-dasharray="339.292" stroke-dashoffset="339.292"></circle>
            </svg>
            <div class="absolute inset-0 flex items-center justify-center">
              <div class="text-center"><div id="scoreLabel" class="text-3xl font-extrabold">0</div><div class="text-sm text-white/60">/100</div></div>
            </div>
          </div>
        </div>
        <div class="glass rounded-2xl p-6">
          <div id="seniorityBadge" class="text-sm text-white/70">Seniority: —</div>
          <div id="industryBadge" class="text-sm text-white/70">Industry: —</div>
          <div id="interestBadge" class="text-sm text-white/70">Recruiter interest: —</div>
          <h3 class="mt-4 font-semibold">Summary</h3>
          <p id="summary" class="text-white/80 mt-1 text-sm"></p>
          <div id="encouragement" class="mt-3 hidden text-emerald-300 text-sm">🎉 High-signal resume. You’re in the top tier—tighten tailoring and outcomes for an even stronger shot.</div>
        </div>
        <div class="glass rounded-2xl p-6">
          <h3 class="font-semibold">Recruiter’s POV</h3>
          <p id="recruiterPOV" class="text-white/80 mt-2 text-sm"></p>
          <div class="mt-4">
            <h4 class="font-semibold mb-2">Role‑readiness tags</h4>
            <div id="readinessTags" class="flex flex-wrap gap-2 text-xs"></div>
          </div>
          <div class="mt-4">
            <h4 class="font-semibold mb-2">Soft‑skill signals</h4>
            <div class="space-y-3 text-sm">
              <div>
                <div class="flex justify-between"><span>Leadership</span><span id="leadershipPct">0%</span></div>
                <div class="meter"><i id="leadershipBar" style="width:0%"></i></div>
              </div>
              <div>
                <div class="flex justify-between"><span>Teamwork</span><span id="teamworkPct">0%</span></div>
                <div class="meter"><i id="teamworkBar" style="width:0%"></i></div>
              </div>
              <div>
                <div class="flex justify-between"><span>Problem‑solving</span><span id="problemPct">0%</span></div>
                <div class="meter"><i id="problemBar" style="width:0%"></i></div>
              </div>
            </div>
          </div>
          <button id="downloadBtn" class="mt-6 rounded-xl bg-purple-400 text-black px-4 py-2 font-semibold hover:bg-purple-300">Download Report</button>
        </div>
      </div>
      <div class="grid md:grid-cols-2 gap-6 mt-6">
        <div class="glass rounded-2xl p-6"><h3 class="font-semibold">Priority Fixes</h3><ol id="topRecs" class="mt-3 list-decimal list-inside space-y-2 text-sm"></ol></div>
        <div class="glass rounded-2xl p-6"><h3 class="font-semibold">50+ Point Checklist</h3><div id="checklist" class="mt-3 space-y-2 text-sm"></div></div>
      </div>
    </section>

    <!-- Job Match Results -->
    <section id="matchResults" class="hidden">
      <div class="grid md:grid-cols-3 gap-6 mt-10">
        <div class="glass rounded-2xl p-6">
          <h3 class="font-semibold">Job Match</h3>
          <div class="text-5xl font-extrabold mt-2"><span id="matchScore">0</span><span class="text-xl align-super">%</span></div>
          <div class="text-white/70 text-sm mt-1">Keyword alignment with the provided JD.</div>
          <div class="mt-4">
            <h4 class="font-semibold mb-2">Tailored bullet (suggestion)</h4>
            <p id="bulletOut" class="text-white/80 text-sm"></p>
          </div>
        </div>
        <div class="glass rounded-2xl p-6">
          <h3 class="font-semibold">Missing / Low‑signal Keywords</h3>
          <ul id="missingKeywords" class="mt-3 text-sm list-disc list-inside"></ul>
        </div>
        <div class="glass rounded-2xl p-6">
          <h3 class="font-semibold">Tailoring Tips</h3>
          <ul id="tailorTips" class="mt-3 text-sm list-disc list-inside"></ul>
        </div>
      </div>
    </section>
  </main>

  <footer class="border-t border-white/10 py-10 text-center text-white/50 text-sm">Built for job seekers. Free & unlimited. Erick Dronski Portfolio.</footer>

<script>
  // Tabs
  const tabResume=document.getElementById('tabResume');
  const tabJob=document.getElementById('tabJob');
  const resumePane=document.getElementById('resumePane');
  const jobPane=document.getElementById('jobPane');
  const resultsEl=document.getElementById('results');
  const matchEl=document.getElementById('matchResults');
  function setTab(which){
    if(which==='resume'){
      tabResume.classList.add('tab-active'); tabJob.classList.remove('tab-active');
      resumePane.classList.remove('hidden'); jobPane.classList.add('hidden');
      resultsEl.classList.remove('hidden'); matchEl.classList.add('hidden');
    } else {
      tabJob.classList.add('tab-active'); tabResume.classList.remove('tab-active');
      jobPane.classList.remove('hidden'); resumePane.classList.add('hidden');
      matchEl.classList.remove('hidden'); resultsEl.classList.add('hidden');
    }
  }
  tabResume.addEventListener('click',()=>setTab('resume'));
  tabJob.addEventListener('click',()=>setTab('job'));
</script>

<script>
  // Input + DnD (Resume)
  const fileInput = document.getElementById('fileInput');
  const fileName  = document.getElementById('fileName');
  const analyzeBtn = document.getElementById('analyzeBtn');
  const dropZone = document.getElementById('dropZone');
  fileInput.addEventListener('change', ()=>{ const f=fileInput.files&&fileInput.files[0]; if(f){ fileName.textContent='Selected: '+f.name; analyzeBtn.disabled=false; }});
  ['dragenter','dragover'].forEach(evt=>dropZone.addEventListener(evt,(e)=>{e.preventDefault();dropZone.classList.add('border-purple-300/60');}));
  ['dragleave','drop'].forEach(evt=>dropZone.addEventListener(evt,(e)=>{e.preventDefault();dropZone.classList.remove('border-purple-300/60');}));
  dropZone.addEventListener('drop',(e)=>{ const f=e.dataTransfer&&e.dataTransfer.files&&e.dataTransfer.files[0]; if(f){ fileInput.files=e.dataTransfer.files; fileInput.dispatchEvent(new Event('change')); }});
  ['dragover','drop'].forEach(evt=>window.addEventListener(evt,e=>e.preventDefault()));

  // Job Match inputs
  const jdFile=document.getElementById('jdFile');
  const jdName=document.getElementById('jdName');
  const jdText=document.getElementById('jdText');
  const genBulletBtn=document.getElementById('genBulletBtn');
  jdFile.addEventListener('change', async ()=>{ const f=jdFile.files&&jdFile.files[0]; if(!f) return; jdName.textContent='Selected: '+f.name; const t=await f.text(); jdText.value=t; });
</script>

<script>
(()=>{
  // PDF.js config (force no-worker for cross-origin safety)
  function setWorker(){ try{ if(window.pdfjsLib&&pdfjsLib.GlobalWorkerOptions){ pdfjsLib.GlobalWorkerOptions.workerSrc='https://unpkg.com/pdfjs-dist@3.11.174/build/pdf.worker.min.js'; if(typeof pdfjsLib.disableWorker==='boolean') pdfjsLib.disableWorker=true; } }catch(e){} }
  if(!window.pdfjsLib){ const s=document.createElement('script'); s.src='https://cdn.jsdelivr.net/npm/pdfjs-dist@3.11.174/build/pdf.min.js'; s.onload=setWorker; document.head.appendChild(s);} else { setWorker(); }

  async function fileToText(file){
    if(!file) throw new Error('No file');
    const isPdf = /\.pdf$/i.test(file.name) || (file.type||'').includes('pdf');
    if(isPdf && window.pdfjsLib){
      try{
        const buf=await file.arrayBuffer();
        const pdf=await pdfjsLib.getDocument({data:buf}).promise; let text='';
        for(let p=1;p<=pdf.numPages;p++){ const page=await pdf.getPage(p); const c=await page.getTextContent(); for(const it of c.items){ text+=it.str+' '; } text+='\n'; }
        if(text.trim().length>5) return text;
      }catch(e){ /* fall back */ }
    }
    return await file.text();
  }

  // ===== Signals & libraries =====
  const ACTION=['led','built','created','launched','designed','implemented','delivered','optimized','deployed','improved','increased','reduced','scaled','migrated','automated','spearheaded','managed','owned','drove','analyzed','developed','mentored'];
  const SOFT={
    leadership:['led','managed','mentored','owned','spearheaded','hired','grew team','head of','director','managed a team','managed team'],
    teamwork:['collaborated','partnered','cross-functional','stakeholders','align','worked with'],
    problem:['solved','debugged','root cause','postmortem','incident','reduced','eliminated','resolved']
  };
  const CLICHES=['results-driven','detail-oriented','team player','self-starter','passionate','hard-working','proven track record','dynamic','fast-paced','synergy','leverage','utilize','responsible for'];
  const ROLE_KEYWORDS={
    software:['javascript','typescript','python','react','node','api','ci/cd','docker','kubernetes','aws','gcp','microservices','graphql','sql','testing','architecture'],
    data:['sql','python','pandas','spark','dbt','airflow','etl','data warehouse','tableau','power bi','ml','regression','classification','feature engineering'],
    product:['roadmap','okrs','kpi','user research','experimentation','a/b testing','backlog','stakeholders','gtm','requirements','wireframe'],
    design:['figma','ux','ui','prototype','wireframe','accessibility','usability','design system'],
    marketing:['seo','sem','campaign','crm','lifecycle','engagement','content','attribution','cac','roas']
  };

  // ===== Utilities =====
  const containsAny=(t,arr)=>{ t=(t||'').toLowerCase(); return arr.some(w=>t.includes(w)); };
  const countHits=(t,arr)=>{ t=(t||'').toLowerCase(); return arr.reduce((a,w)=>a+(t.includes(w)?1:0),0); };
  const hasDigits=t=>/\d/.test(t||'');
  const hasMetric=t=> hasDigits(t) && /%|\$|users|customers|revenue|growth|roi|leads|transactions|latency|speed|hours|\bk\b|\bm\b|x/i.test(t||'');
  const capsOveruse=t=>{ const words=(t||'').split(/\s+/); let caps=0; for(const w of words){ if(w.length>4&&/[A-Z]/.test(w)&&w===w.toUpperCase()) caps++; } return caps>30; };

  // Better seniority inference: recent‑title override + years fallback
  function inferSeniority(text){
    const t=(text||'').toLowerCase();
    // look at first ~400 words (recent roles / summary) for titles
    const head=t.split(/\s+/).slice(0,400).join(' ');
    const titleMap=[
      {re:/\b(intern|internship)\b/, lvl:'junior', score:0},
      {re:/\b(junior|jr\.?|associate)\b/, lvl:'junior', score:1},
      {re:/\b(mid[-\s]?level|mid)\b/, lvl:'mid', score:2},
      {re:/\b(senior|sr\.?|lead)\b/, lvl:'senior', score:3},
      {re:/\b(staff|principal)\b/, lvl:'senior', score:4},
      {re:/\b(manager|management)\b/, lvl:'senior', score:4},
      {re:/\b(director|head of)\b/, lvl:'executive', score:5},
      {re:/\b(vp|vice president|chief|cto|cpo|cio)\b/, lvl:'executive', score:6}
    ];
    let best={lvl:null, score:-1};
    for(const r of titleMap){ if(r.re.test(head) && r.score>best.score) best=r; }
    // years fallback (search whole text)
    const years=(t.match(/(\d{1,2})\s*(years|yrs)/g)||[]).map(s=>parseInt(s)).filter(n=>!isNaN(n));
    const yr=Math.max(0,...years);
    let lvlYr= yr>=12?'executive': yr>=7?'senior': yr>=3?'mid':'junior';
    // combine: if title evidence exists, trust it over years (people with 10+ yrs can still be IC)
    const lvl = best.lvl || lvlYr;
    return lvl;
  }
  function inferIndustry(text){ const K={software:['javascript','python','react','node','api','aws','docker','kubernetes','sql','ml','ai'],data:['data','analytics','etl','warehouse','dbt','spark','tableau'],finance:['fintech','cfa','risk','valuation','portfolio','trading'],marketing:['seo','sem','campaign','crm','engagement'],healthcare:['clinical','ehr','hipaa','trial'],design:['figma','ux','ui','wireframe']}; const t=(text||'').toLowerCase(); let best='general',hits=0; for(const k in K){ const c=countHits(t,K[k]); if(c>hits){hits=c;best=k;} } return best; }

  // ===== Criteria =====
  const CRIT=[]; const add=(l,w,ch,r)=>CRIT.push({label:l,weight:w,check:ch,rec:r});
  add('Has contact info (email/phone)',3,c=>/.+@.+\..+/.test(c.t)||/\+?\d[\d\-\s]{6,}/.test(c.t),'Add email & phone in header.');
  add('LinkedIn/portfolio link',2,c=>/linkedin\.com|github\.com|portfolio/i.test(c.t),'Link LinkedIn/portfolio.');
  add('Concise professional summary',2,c=>/summary|objective|profile/i.test(c.t),'Add a 2–3 sentence value summary.');
  add('Clear sections',3,c=>/experience/i.test(c.t)&&/education/i.test(c.t)&&/skills/i.test(c.t),'Use standard sections.');
  add('Uses bullet points',2,c=>/[•\-]/.test(c.t),'Use bullets for scannability.');
  add('1–2 pages max',2,c=>c.pages<=2,'Keep to 1 page (junior) or 1–2 (senior).');
  add('ATS‑safe formatting',2,c=>!/table|headshot|photo/i.test(c.t),'Avoid tables/images/headshots.');
  add('Includes metrics/quant results',4,c=>hasMetric(c.t),'Quantify results (%, $, time saved).');
  add('Strong action verbs',3,c=>containsAny(c.t,ACTION),'Lead bullets with strong verbs.');
  add('Focus on achievements over responsibilities',2,c=>!/(responsible for|duties include)/i.test(c.t),'Rephrase to outcomes.');
  add('Leadership signals present',1,c=>containsAny(c.t,SOFT.leadership),'Show leadership (mentored/led/owned).');
  add('Teamwork signals',1,c=>containsAny(c.t,SOFT.teamwork),'Mention partners & stakeholders.');
  add('Problem‑solving signals',1,c=>containsAny(c.t,SOFT.problem),'Describe diagnosis & fix.');
  add('Avoid ALL‑CAPS overuse',1,c=>!capsOveruse(c.t),'Reserve ALL‑CAPS for headings.');
  add('Dedicated Skills section',2,c=>/\bskills\b/i.test(c.t),'Add a curated Skills section.');
  add('Each role has dates',2,c=>/(20\d{2}|201\d)/.test(c.t),'Add month/year ranges.');
  add('Education listed',1,c=>/education|bachelor|master|university|degree/i.test(c.t),'Add education (degree/school).');
  add('Low typo risk',3,c=>{ const parts=c.t.split(' '); let weird=0; for(const w of parts){ if(w.length>20 && /[^\w@.&,%\-]/.test(w)) weird++; } return weird<10; },'Run a spell/grammar pass.');
  // New criteria
  add('Avoid cliché/AI‑style phrasing',2,c=>!containsAny(c.t,CLICHES),'Replace clichés (e.g., “results‑driven”, “detail‑oriented”) with quantified outcomes.');
  add('Role‑specific signals present',2,c=>{ const ind=inferIndustry(c.t); const keys=ROLE_KEYWORDS[ind]||[]; return keys.length?containsAny(c.t,keys):true; },'Surface role‑specific keywords and examples near the top.');

  // ===== Analyzer =====
  function analyze(text,file){
    const ctx={ t:text||'', pages:(text.match(/\f/g)||[]).length+1, name:file&&file.name };
    let score=100; const results=[];
    CRIT.forEach(c=>{ const pass=!!c.check(ctx); if(!pass) score-=c.weight; results.push({label:c.label,pass,rec:c.rec,weight:c.weight}); });
    score=Math.max(0,Math.min(100,score));
    const failed=results.filter(r=>!r.pass).sort((a,b)=>b.weight-a.weight).slice(0,8);
    const wins=results.filter(r=>r.pass).slice(0,5).map(r=>r.label);
    const sen=inferSeniority(text); const ind=inferIndustry(text);
    const interest=score>=90?5:score>=80?4:score>=70?3:score>=60?2:1;
    const summary='Your resume reads as a '+sen+' '+ind+' profile. We analyzed '+CRIT.length+'+ signals across structure, clarity, impact, skills, soft skills, ATS compatibility, cliché‑avoidance, and role signals.';
    const pov=(score>=90?('“High‑signal '+sen+' '+ind+'. Shortlist material. What shines: '+wins.join(', ')+'. Next: tailor to top role priorities and add 1–2 business outcomes.”'):
               score>=75?('“Strong '+sen+' '+ind+'. Interview likely. What shines: '+wins.join(', ')+'. Next: tighten metrics and alignment.”'):
               score>=60?('“Promising foundation. Clarify impact with numbers and improve formatting for quick scan.”'):
                          '“Key elements are missing. Fix fundamentals (contact, sections, quantified results) to get traction.”');
    // Soft-skill meters
    const leadScore=Math.min(100, countHits(text,SOFT.leadership)*12+ (text.includes('manager')?10:0));
    const teamScore=Math.min(100, countHits(text,SOFT.teamwork)*12);
    const probScore=Math.min(100, countHits(text,SOFT.problem)*12 + (hasMetric(text)?8:0));
    // Readiness tags
    const tags=[];
    if(leadScore>=55 && (interest>=3 || containsAny(text,SOFT.leadership))) tags.push('IC Lead‑ready');
    if(leadScore>=65 || /managed|mentored|hired|grew team/i.test(text)) tags.push('Team‑builder');
    if(probScore>=60 && hasMetric(text)) tags.push('Execution‑heavy');
    if(tags.length===0 && interest>=4) tags.push('High‑signal');
    return {score,failed,wins,summary,sen,ind,interest,pov,results,leadScore,teamScore,probScore,tags};
  }

  // ===== Resume analyze binder =====
  const sArc=document.getElementById('scoreArc');
  const sLab=document.getElementById('scoreLabel');
  const badges={sen:document.getElementById('seniorityBadge'),ind:document.getElementById('industryBadge'),interest:document.getElementById('interestBadge')};
  const leadershipBar=document.getElementById('leadershipBar');
  const teamworkBar=document.getElementById('teamworkBar');
  const problemBar=document.getElementById('problemBar');
  const leadershipPct=document.getElementById('leadershipPct');
  const teamworkPct=document.getElementById('teamworkPct');
  const problemPct=document.getElementById('problemPct');
  const readinessTags=document.getElementById('readinessTags');

  document.getElementById('analyzeBtn').addEventListener('click', async ()=>{
    const f=fileInput.files&&fileInput.files[0]; if(!f){ alert('Please choose a PDF or TXT file first.'); return; }
    analyzeBtn.disabled=true; analyzeBtn.textContent='Analyzing…';
    try{
      const text=await fileToText(f); const r=analyze(text,f);
      resultsEl.classList.remove('hidden'); matchEl.classList.add('hidden'); setTab('resume');
      const C=339.292; if(sArc) sArc.style.strokeDashoffset=String(C*(1-r.score/100)); if(sLab) sLab.textContent=String(Math.round(r.score));
      badges.sen.textContent='Seniority: '+r.sen; badges.ind.textContent='Industry: '+r.ind; badges.interest.textContent='Recruiter interest: '+r.interest+'/5';
      document.getElementById('summary').textContent=r.summary; document.getElementById('recruiterPOV').textContent=r.pov; document.getElementById('encouragement').classList.toggle('hidden', r.score<90);
      // Priority + checklist
      const top=document.getElementById('topRecs'); top.innerHTML=''; r.failed.forEach(it=>{ const li=document.createElement('li'); li.innerHTML='<span class="font-semibold">'+it.label+'</span> — '+it.rec; top.appendChild(li); });
      const list=document.getElementById('checklist'); list.innerHTML=''; r.results.forEach(it=>{ const div=document.createElement('div'); div.className='flex items-start gap-3 rounded-xl border border-white/10 bg-white/5 p-3'; div.innerHTML='<div class="mt-1 '+(it.pass?'ok':'bad')+'">'+(it.pass?'✔':'✖')+'</div><div><div class="font-medium">'+it.label+'</div><div class="text-sm text-white/70">'+(it.pass?'Looks good.':it.rec)+'</div></div>'; list.appendChild(div); });
      // Soft-skill meters
      leadershipBar.style.width=r.leadScore+'%'; leadershipPct.textContent=r.leadScore+'%';
      teamworkBar.style.width=r.teamScore+'%'; teamworkPct.textContent=r.teamScore+'%';
      problemBar.style.width=r.probScore+'%'; problemPct.textContent=r.probScore+'%';
      // Readiness tags
      readinessTags.innerHTML='';
      r.tags.forEach(t=>{ const pill=document.createElement('span'); pill.className='px-2 py-1 rounded-full border border-white/10 bg-white/5'; pill.textContent=t; readinessTags.appendChild(pill); });
      // Download report
      document.getElementById('downloadBtn').onclick=()=>{ const html='<!doctype html><html><head><meta charset="utf-8"><title>AI Resume Report</title><style>body{font-family:system-ui,Segoe UI,Arial;max-width:900px;margin:40px auto;background:#0b1220;color:#e6e9f5} .card{background:#111827;padding:16px;border-radius:14px;margin:10px 0;border:1px solid #334155} .ok{color:#8B5CF6}.bad{color:#ef4444} .muted{color:#a3a3a3} .pill{display:inline-block;border:1px solid #334155;border-radius:999px;padding:2px 8px;margin-right:6px}</style></head><body><h1>AI Resume Analyzer — Report</h1><div class="muted">Score: <b>'+Math.round(r.score)+'</b>/100 • Interest: '+r.interest+'/5 • Seniority: '+r.sen+' • Industry: '+r.ind+'</div><div class="card"><h3>Recruiter’s POV</h3><blockquote>'+r.pov+'</blockquote></div><div class="card"><h3>Summary</h3><p>'+r.summary+'</p>'+((r.score>=90)?'<p><b>Encouragement:</b> You’re very close to best‑in‑stack. Add business outcomes and leadership signals to seal it.</p>':'')+'</div><div class="card"><h3>Role‑readiness</h3>'+r.tags.map(x=>'<span class="pill">'+x+'</span>').join(' ')+'</div><div class="card"><h3>Priority Fixes</h3><ol>'+r.failed.map(x=>'<li><b>'+x.label+':</b> '+x.rec+'</li>').join('')+'</ol></div><div class="card"><h3>Checklist</h3>'+r.results.map(x=>'<div><span class="'+(x.pass?'ok':'bad')+'">'+(x.pass?'✔':'✖')+'</span> '+x.label+(x.pass?'':' — '+x.rec)+'</div>').join('')+'</div><p class="muted">Generated locally in your browser. Re‑run after edits to watch your score rise.</p></body></html>'; const blob=new Blob([html],{type:'text/html'}); const url=URL.createObjectURL(blob); const a=document.createElement('a'); a.href=url; a.download='AI_Resume_Report.html'; a.click(); setTimeout(()=>URL.revokeObjectURL(url),1000); };
      window.scrollTo({ top: resultsEl.offsetTop - 20, behavior: 'smooth' });
    }catch(err){ console.error(err); alert('Analyze failed. If this was a scanned PDF (image‑only), export a text‑based PDF or upload .txt.'); }
    finally{ analyzeBtn.disabled=false; analyzeBtn.textContent='Analyze Resume'; }
  });

  // ===== JD Match / Gap analysis =====
  function tokenize(t){ return (t||'').toLowerCase().replace(/[^a-z0-9+.#\-\s]/g,' ').split(/\s+/).filter(w=>w && w.length>2 && !['and','the','for','with','that','this','from','into','your','you','are','our','their','was','were','a','an','to','in','of','on','as','by','at','be'].includes(w)); }
  function topKeywords(t, limit=30){ const tok=tokenize(t); const m=new Map(); tok.forEach(w=>m.set(w,(m.get(w)||0)+1)); return [...m.entries()].sort((a,b)=>b[1]-a[1]).slice(0,limit).map(([w])=>w); }

  document.getElementById('analyzeMatchBtn').addEventListener('click', async ()=>{
    const f=fileInput.files&&fileInput.files[0]; if(!f){ alert('Upload your resume first on the Resume tab.'); setTab('resume'); return; }
    const resumeText = await (async()=>{ try{ return await fileToText(f);}catch(_){ return ''; }})();
    let jd = jdText.value.trim(); if(!jd){ alert('Paste or upload a job description first.'); return; }

    const jdKeys = new Set(topKeywords(jd, 60));
    const resKeys = new Set(topKeywords(resumeText, 140));
    const ind = inferIndustry(resumeText); (ROLE_KEYWORDS[ind]||[]).forEach(k=>jdKeys.add(k));

    let hit=0; const total=jdKeys.size||1; const missing=[]; const present=[];
    jdKeys.forEach(k=>{ if(resKeys.has(k)) { hit++; present.push(k); } else { missing.push(k); } });
    const score = Math.round((hit/total)*100);

    const tips=[];
    if(score<85) tips.push('Add 3–5 missing keywords into your Summary and the most recent role bullets.');
    if(containsAny(resumeText,CLICHES)) tips.push('Replace clichés with quantified outcomes tied to JD priorities.');
    if(!containsAny(resumeText, ACTION)) tips.push('Start bullets with action verbs aligned to the JD (built, implemented, optimized).');
    if(!hasMetric(resumeText)) tips.push('Attach a metric to at least half of your bullets (%, $, time, users).');

    document.getElementById('matchScore').textContent = String(score);
    const missUl=document.getElementById('missingKeywords'); missUl.innerHTML='';
    missing.slice(0,20).forEach(k=>{ const li=document.createElement('li'); li.textContent=k; missUl.appendChild(li); });
    const tipsUl=document.getElementById('tailorTips'); tipsUl.innerHTML='';
    tips.forEach(t=>{ const li=document.createElement('li'); li.textContent=t; tipsUl.appendChild(li); });

    setTab('job');
  });

  // One‑click tailored bullet from JD
  genBulletBtn.addEventListener('click', async ()=>{
    const f=fileInput.files&&fileInput.files[0]; if(!f){ alert('Upload your resume first.'); return; }
    const resumeText = await (async()=>{ try{ return await fileToText(f);}catch(_){ return ''; }})();
    const jd = jdText.value.trim(); if(!jd){ alert('Paste or upload a job description first.'); return; }
    const jdKeys=topKeywords(jd,40); const resKeys=topKeywords(resumeText,120);
    const missing=jdKeys.filter(k=>!resKeys.includes(k)).slice(0,3);
    const verb=(ACTION.find(v=>!v.includes(' '))||'delivered');
    const metricHint = hasMetric(resumeText)?'':', achieving <metric>';
    const bullet = `${verb.charAt(0).toUpperCase()+verb.slice(1)} ${missing.join(', ')} initiatives that mapped to top JD priorities${metricHint}.`;
    document.getElementById('bulletOut').textContent = bullet;
    setTab('job');
  });
})();
</script>
</body>
</html>
